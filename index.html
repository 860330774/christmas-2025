<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silky Smooth Christmas (Big Brush)</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #050505;
            height: 100vh;
            width: 100vw;
            cursor: none;
            user-select: none;
        }

        /* 1. åº•å±‚ï¼šé™æ€èƒŒæ™¯ (æ ‘ + å­—) */
        #bgCanvas {
            position: absolute;
            top: 0; left: 0;
            z-index: 1;
        }

        /* 2. ä¸­é—´å±‚ï¼šåŠ¨æ€é›¾æ°” */
        #fogCanvas {
            position: absolute;
            top: 0; left: 0;
            z-index: 10;
        }

        /* 3. æç¤ºæ–‡å­— */
        .guide {
            position: absolute;
            bottom: 50px; left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.4);
            font-family: sans-serif;
            font-size: 14px;
            letter-spacing: 2px;
            pointer-events: none;
            z-index: 11;
            animation: fadeOut 4s forwards 2s;
        }
        @keyframes fadeOut { to { opacity: 0; } }

        /* 4. æ‰è½ç²’å­ */
        .falling-item {
            position: absolute;
            pointer-events: none;
            font-size: 24px;
            z-index: 9999;
            will-change: transform, opacity;
            filter: drop-shadow(0 0 2px rgba(255,255,255,0.5));
        }

        /* å…‰æ ‡ */
        #cursor-glow {
            position: absolute;
            width: 80px; /* å…‰æ ‡å…‰æ™•ä¹Ÿç¨å¾®è°ƒå¤§ä¸€ç‚¹ */
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 9998;
            mix-blend-mode: screen;
        }
    </style>
</head>
<body>

    <canvas id="bgCanvas"></canvas>
    <canvas id="fogCanvas"></canvas>
    <div class="guide">æ»‘åŠ¨é¼ æ ‡ï¼Œæ“¦é™¤é­”æ³•æ°”æ³¡...</div>
    <div id="cursor-glow"></div>

    <script>
        // === å…¨å±€ ===
        let width = window.innerWidth;
        let height = window.innerHeight;

        // === 1. é™æ€èƒŒæ™¯å±‚ ===
        const bgCvs = document.getElementById('bgCanvas');
        const bCtx = bgCvs.getContext('2d');

        function initBackground() {
            bgCvs.width = width;
            bgCvs.height = height;

            // èƒŒæ™¯æ¸å˜
            const gradient = bCtx.createRadialGradient(width/2, height/2, 0, width/2, height/2, height);
            gradient.addColorStop(0, '#1a0b2e'); 
            gradient.addColorStop(1, '#000000'); 
            bCtx.fillStyle = gradient;
            bCtx.fillRect(0, 0, width, height);

            drawStaticTree();
            drawArtText();
        }

        function drawStaticTree() {
            const startY = height * 0.25;
            const endY = height * 0.9;
            const treeHeight = endY - startY;

            bCtx.save();
            bCtx.shadowBlur = 15;
            bCtx.shadowColor = "gold";
            
            for (let i = 0; i < 400; i++) {
                const yRatio = Math.random();
                const y = startY + yRatio * treeHeight;
                const maxRadius = 10 + yRatio * (width * 0.22);
                const angle = Math.random() * Math.PI * 2;
                const r = Math.sqrt(Math.random()) * maxRadius;
                const x = width/2 + Math.cos(angle) * r;
                
                const colors = ['#FFD700', '#FF3333', '#33FF33', '#FFFFFF'];
                const color = colors[Math.floor(Math.random() * colors.length)];

                bCtx.beginPath();
                bCtx.fillStyle = color;
                bCtx.arc(x, y, Math.random() * 3 + 1, 0, Math.PI*2);
                bCtx.fill();
            }
            
            // æ˜Ÿæ˜Ÿ
            bCtx.shadowBlur = 30;
            bCtx.shadowColor = "#ffff00";
            bCtx.fillStyle = "#ffffaa";
            bCtx.beginPath();
            bCtx.arc(width/2, startY - 10, 12, 0, Math.PI*2);
            bCtx.fill();
            bCtx.restore();
        }

        function drawArtText() {
            bCtx.save();
            const fontSize = Math.min(width, height) * 0.12;
            bCtx.font = `bold italic ${fontSize}px "Brush Script MT", cursive, serif`;
            bCtx.textAlign = "center";
            bCtx.textBaseline = "middle";
            
            bCtx.shadowColor = "#ff00de";
            bCtx.shadowBlur = 30;
            bCtx.fillStyle = "rgba(255, 0, 222, 0.3)";
            bCtx.fillText("Merry Christmas", width/2, height/2);

            bCtx.shadowBlur = 10;
            bCtx.fillStyle = "#fff";
            bCtx.fillText("Merry Christmas", width/2, height/2);
            bCtx.restore();
        }


        // === 2. åŠ¨æ€é›¾æ°”å±‚ ===
        const fogCvs = document.getElementById('fogCanvas');
        const fCtx = fogCvs.getContext('2d');
        const maskCvs = document.createElement('canvas');
        const mCtx = maskCvs.getContext('2d');

        let bubbles = [];
        let lastPos = null;

        class Bubble {
            constructor() {
                this.init();
            }
            init() {
                this.x = Math.random() * width;
                this.y = height + Math.random() * 100;
                this.radius = Math.random() * 10 + 5;
                this.speed = Math.random() * 1.5 + 0.5;
                this.opacity = Math.random() * 0.4 + 0.1;
                this.wobble = Math.random() * Math.PI * 2;
            }
            update() {
                this.y -= this.speed;
                this.wobble += 0.03;
                this.x += Math.sin(this.wobble) * 0.5;
                if (this.y < -20) this.init();
            }
            draw(ctx) {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
                ctx.fillStyle = `rgba(200, 230, 255, ${this.opacity})`;
                ctx.fill();
                ctx.strokeStyle = `rgba(255, 255, 255, ${this.opacity + 0.1})`;
                ctx.lineWidth = 0.5;
                ctx.stroke();
            }
        }

        function initFog() {
            fogCvs.width = width;
            fogCvs.height = height;
            maskCvs.width = width;
            maskCvs.height = height;

            bubbles = [];
            for(let i=0; i<100; i++) {
                const b = new Bubble();
                b.y = Math.random() * height;
                bubbles.push(b);
            }
        }

        function renderFogLoop() {
            fCtx.clearRect(0, 0, width, height);

            // èƒŒæ™¯é›¾è‰²
            fCtx.fillStyle = 'rgba(15, 20, 30, 0.9)'; 
            fCtx.fillRect(0, 0, width, height);

            // ç»˜åˆ¶æ°”æ³¡
            bubbles.forEach(b => {
                b.update();
                b.draw(fCtx);
            });

            // åº”ç”¨åˆ®ç—• Mask
            fCtx.globalCompositeOperation = 'destination-out';
            fCtx.drawImage(maskCvs, 0, 0);
            fCtx.globalCompositeOperation = 'source-over';

            requestAnimationFrame(renderFogLoop);
        }

        // --- æ ¸å¿ƒä¿®æ”¹ï¼šåŠ å¤§ç¬”åˆ· ---
        function scratch(x, y) {
            mCtx.lineCap = 'round';
            mCtx.lineJoin = 'round';
            // ä¿®æ”¹ç‚¹ 1: çº¿æ¡å®½åº¦ä» 80 æ”¹ä¸º 150
            mCtx.lineWidth = 150; 
            mCtx.strokeStyle = '#000';
            
            mCtx.beginPath();
            if (lastPos) {
                mCtx.moveTo(lastPos.x, lastPos.y);
                mCtx.lineTo(x, y);
                mCtx.stroke();
            }
            
            // ä¿®æ”¹ç‚¹ 2: è¡¥æ¼åœ†ç‚¹çš„åŠå¾„ä» 40 æ”¹ä¸º 75 (lineWidthçš„ä¸€åŠ)
            mCtx.beginPath();
            mCtx.arc(x, y, 75, 0, Math.PI*2);
            mCtx.fill();

            lastPos = {x, y};
        }


        // === 3. æ‹–å°¾ç²’å­ ===
        const EMOJIS = ['ğŸ„', 'âœ¨', 'â„ï¸', 'ğŸ', 'ğŸ””'];
        let particles = [];
        let dropThrottle = 0;

        class Particle {
            constructor(x, y) {
                this.el = document.createElement('div');
                this.el.className = 'falling-item';
                this.el.innerText = EMOJIS[Math.floor(Math.random() * EMOJIS.length)];
                document.body.appendChild(this.el);
                
                // ç¨å¾®åˆ†æ•£ä¸€ç‚¹æ‰è½ä½ç½®
                this.x = x + (Math.random()-0.5)*30; 
                this.y = y + (Math.random()-0.5)*30;
                this.vx = (Math.random() - 0.5) * 6;
                this.vy = Math.random() * -6 - 3; 
                this.grav = 0.4;
                this.rot = Math.random() * 360;
                this.life = 1.0;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += this.grav;
                this.rot += 5;
                this.life -= 0.02; 
                this.el.style.transform = `translate(${this.x}px, ${this.y}px) rotate(${this.rot}deg)`;
                this.el.style.opacity = this.life;
            }
        }

        function loopParticles() {
            for(let i=particles.length-1; i>=0; i--) {
                const p = particles[i];
                p.update();
                if(p.life <= 0 || p.y > height + 50) {
                    p.el.remove();
                    particles.splice(i, 1);
                }
            }
            requestAnimationFrame(loopParticles);
        }

        // === 4. äº¤äº’ç»‘å®š ===
        const cursor = document.getElementById('cursor-glow');

        function handleInput(x, y) {
            cursor.style.left = x + 'px';
            cursor.style.top = y + 'px';
            
            scratch(x, y);

            dropThrottle++;
            if(dropThrottle % 3 === 0) { 
                particles.push(new Particle(x, y));
            }
        }

        document.addEventListener('mousemove', e => {
            if (lastPos && Math.hypot(e.clientX - lastPos.x, e.clientY - lastPos.y) > 100) {
                lastPos = { x: e.clientX, y: e.clientY };
            }
            handleInput(e.clientX, e.clientY);
        });
        document.addEventListener('mouseup', () => lastPos = null);
        
        window.addEventListener('resize', () => {
            width = window.innerWidth;
            height = window.innerHeight;
            initBackground();
            initFog();
        });

        initBackground();
        initFog();
        renderFogLoop();
        loopParticles();

    </script>
</body>
</html>